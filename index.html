<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Informatique avec JUSWELL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />    
  <style>
    :root{--primary:#1453ff;--bg:#f7fafc;--text:#111827;--muted:#6b7280;--card:#eef2ff;}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,Arial,sans-serif;background:var(--bg);color:var(--text)} header{background:var(--primary);color:#fff;padding:12px;display:flex;align-items:center;justify-content:space-between}
    .menu-btn{display:flex;align-items:center;gap:10px;cursor:pointer}
    .menu-lines{display:flex;flex-direction:column;gap:4px}
    .menu-lines div{width:26px;height:3px;background:#fff;border-radius:2px}
    .top-right{display:flex;flex-direction:column;align-items:flex-end}
    .top-right a{color:#fff;text-decoration:none;font-weight:700}
    .top-right a+a{margin-top:4px}

    /* Menu lat√©ral gauche (slide-in) */
    nav#menu{
      position:fixed; top:0; left:0; height:100vh; width:270px;
      background:var(--primary); color:#fff; padding:20px;
      transform:translateX(-100%); transition:transform .3s ease; z-index:1000;
      box-shadow:0 0 20px rgba(0,0,0,.2);
    }
    nav#menu.open{transform:translateX(0)}
    nav#menu h3{margin:0 0 12px 0}
    nav#menu a{display:block;color:#fff;text-decoration:none;padding:12px 0;border-bottom:1px solid rgba(255,255,255,.2)}
    nav#menu a:last-child{border-bottom:none}
    .menu-overlay{
      position:fixed; inset:0; background:rgba(0,0,0,.25); backdrop-filter:blur(2px);
      opacity:0; pointer-events:none; transition:opacity .3s ease; z-index:900;
    }
    .menu-overlay.show{opacity:1; pointer-events:auto}

    .container{max-width:1100px;margin:20px auto;padding:0 12px}
    h1{color:var(--primary)}
    .card{background:var(--card);border-radius:12px;padding:16px;margin:12px 0}
    .muted{color:var(--muted)}
    .hidden{display:none!important}
    footer{background:var(--primary);color:#fff;padding:12px;text-align:center;margin-top:30px}
    input,select,textarea{width:100%;padding:10px;margin:6px 0;border:1px solid #cbd5e1;border-radius:8px}
    button{background:var(--primary);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
    button.secondary{background:#e5e7eb;color:#111}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .small-input{flex:0 0 90px;text-align:center}
    .tabbar{display:flex;gap:8px;margin-bottom:8px}
    .tabbtn{background:#e5e7eb;color:#111;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    .tabbtn.active{background:var(--primary);color:#fff}
    .file-item{display:flex;align-items:center;justify-content:space-between;background:#fff;border-radius:8px;padding:8px;margin:6px 0}
    .file-item a{color:#1453ff;text-decoration:none;word-break:break-all}

    .sidebar{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}
    .sidebtn{background:#e5e7eb;color:#111;padding:10px;border-radius:8px;text-align:left;cursor:pointer}
    .sidebtn.active{background:var(--primary);color:#fff}
    .details{background:#fff;padding:10px;border-radius:8px;margin-top:6px}

    /* Messagerie (vertical + input en bas) */
    .chat-thread{display:flex;flex-direction:column;gap:6px;max-height:360px;overflow:auto;padding:6px;background:#fff;border-radius:10px}
    .msg{max-width:75%;padding:8px 12px;border-radius:12px}
    .msg.student{align-self:flex-start;background:#eef2ff;color:#111;border-bottom-left-radius:4px}
    .msg.admin{align-self:flex-end;background:#1453ff;color:#fff;border-bottom-right-radius:4px}
    .chat-input{display:flex;gap:8px;margin-top:8px}
    .chat-input textarea{flex:1;min-height:46px}

    /* Admin inbox layout */
    .inbox-layout{display:flex;gap:14px;flex-wrap:wrap}
    .inbox-sidebar{flex:0 0 280px;background:#fff;border-radius:10px;padding:10px;max-height:400px;overflow:auto}
    .inbox-list{display:flex;flex-direction:column;gap:6px}
    .inbox-user{display:flex;align-items:center;gap:8px;padding:8px;border-radius:8px;cursor:pointer}
    .inbox-user:hover{background:#f5f7ff}
    .avatar{width:28px;height:28px;border-radius:50%;background:#dbeafe;display:flex;align-items:center;justify-content:center;font-weight:700;color:#1f3bcc}
    .inbox-panel{flex:1;background:#fff;border-radius:10px;padding:10px;display:flex;flex-direction:column}
  </style>
</head>
<body>
  <header>
    <div class="menu-btn" onclick="toggleMenu()">
      <div class="menu-lines"><div></div><div></div><div></div></div>
      <span>Menu</span>
    </div>
    <div id="top-right" class="top-right">
      <a href="#" onclick="go('register-step1')">S‚Äôinscrire</a>
      <a href="#" onclick="go('login')">Se connecter</a>
    </div>
  </header>

  <nav id="menu">
    <h3>Menu</h3>
    <a href="#" onclick="closeMenu(); go('home')">Accueil</a>
    <a href="#" onclick="closeMenu(); go('dashboard')">Tableau de bord</a>
    <a href="#" onclick="closeMenu(); go('admin-login')">Espace administrateur</a>
    <a href="#" onclick="closeMenu(); go('privacy')">Confidentialit√©</a>
    <a href="#" onclick="closeMenu(); logout()">Se d√©connecter</a>
  </nav>
  <div id="menu-overlay" class="menu-overlay" onclick="closeMenu()"></div>

  <main class="container">
    <!-- Accueil avec ton image paysage -->
    <section id="home" class="page">
      <h1>Informatique avec JUSWELL</h1>
       <h1>Soyez les bienvenue sur cette plateforme !</h1>
       <h2>Ici votre ma√Ætrise, notre priorit√©</h2>
      
    <div class="card">
           <div class="card">
        <img src="image.jpg""
             style="width:100%;border-radius:12px;">
      </div>
      <h2>Inscrivez-vous puis connectez √† votre classe</h2>
      <div class="card"><h3>D√©butant</h3><p class="muted">Utilisation de base, bureautique, internet.</p><button onclick="openClass('DEB')">Voir la classe</button></div>
      <div class="card"><h3>Moyen</h3><p class="muted">Excel avanc√©, programmation, r√©seaux.</p><button onclick="openClass('MOY')">Voir la classe</button></div>
      <div class="card"><h3>Avanc√©</h3><p class="muted">D√©veloppement web, bases de donn√©es, s√©curit√©.</p><button onclick="openClass('AVA')">Voir la classe</button></div>
    </section>

    <!-- Inscription ‚Äî √âtape 1 -->
    <section id="register-step1" class="page hidden">
      <h2>Inscription ‚Äî √âtape 1</h2>
      <div class="card">
        <label>Nom</label><input id="r_last" placeholder="Ex: KOSSI">
        <label>Pr√©nom</label><input id="r_first" placeholder="Ex: Ama">
        <label>Email</label><input id="r_email" type="email" placeholder="exemple@mail.com">
        <label>T√©l√©phone</label>
        <div class="row">
          <input id="r_phone_code" class="small-input" placeholder="+228">
          <input id="r_phone" type="tel" placeholder="92239333">
        </div>
        <label>Ville</label><input id="r_city" placeholder="Ex: Kpalim√©">
        <label>Pays</label><input id="r_country" placeholder="Ex: TOGO">
        <div class="row">
          <button onclick="nextStep(1)">Suivant</button>
          <button class="secondary" onclick="go('home')">Annuler</button>
        </div>
      </div>
    </section>

    <!-- Inscription ‚Äî √âtape 2 -->
    <section id="register-step2" class="page hidden">
      <h2>Inscription ‚Äî √âtape 2</h2>
      <div class="card">
        <label>Niveau d‚Äô√©tude</label>
        <select id="r_study">
          <option>CEPD</option><option>BEPC</option><option>BAC1</option><option>BAC2</option><option>Licence</option>
        </select>
        <label>Profession</label><input id="r_job" placeholder="Ex: √âtudiant, Enseignant, ...">
        <label>Niveau informatique</label>
        <select id="r_it"><option>D√©butant</option><option>Moyen</option><option>Avanc√©</option></select>
        <label>Niveau de formation (classe)</label>
        <select id="r_training"><option value="DEB">D√©butant</option><option value="MOY">Moyen</option><option value="AVA">Avanc√©</option></select>
        <div class="row">
          <button onclick="nextStep(2)">Suivant</button>
          <button class="secondary" onclick="go('register-step1')">Pr√©c√©dent</button>
        </div>
      </div>
    </section>

    <!-- Inscription ‚Äî √âtape 3 -->
    <section id="register-step3" class="page hidden">
      <h2>Inscription ‚Äî √âtape 3 (Paiement simul√©)</h2>
      <div class="card">
        <label><input type="checkbox" id="r_confirm"> Je confirme le paiement</label>
        <div class="row">
          <button onclick="finishRegister()">Terminer</button>
          <button class="secondary" onclick="go('register-step2')">Pr√©c√©dent</button>
        </div>
        <p class="muted">Un code sera g√©n√©r√© selon la classe: D-XXXXXX / M-XXXXXX / A-XXXXXX.</p>
        <!-- Formulaire invisible-step3 -->
<form id="send-code-form" action="inscription.php" method="post" style="display:none;">
  <input type="hidden" name="nom" id="hidden-nom">
  <input type="hidden" name="email" id="hidden-email">
  <input type="hidden" name="code" id="hidden-code">
</form>
        <script>
// R√©cup√®re le nom saisi (remplace "r-nom" par l'id r√©el de ton champ Nom)
function getNom() {
  return document.getElementById("r-nom").value.trim();
}

// R√©cup√®re l'email saisi (remplace "r-email" par l'id r√©el de ton champ Email)
function getEmail() {
  return document.getElementById("r-email").value.trim();
}

// R√©cup√®re la classe choisie (remplace "r-classe" par l'id r√©el de ton champ Classe)
function getSelectedClasse() {
  const el = document.getElementById("r-classe");
  return el ? el.value : "D"; // Valeur par d√©faut si rien n'est choisi
}

// G√©n√®re le code selon la classe (ex: D-123456)
function generateCodeFor(classe) {
  const prefix = ["D","M","A"].includes(classe) ? classe : "D";
  const num = Math.floor(100000 + Math.random() * 900000);
  return `${prefix}-${num}`;
}

// Fonction appel√©e quand l'√©l√®ve clique sur "Terminer"
function finishRegister() {
  // V√©rifier la confirmation de paiement
  if (!document.getElementById("r-confirm").checked) {
    alert("Veuillez confirmer le paiement avant de terminer.");
    return;
  }

  // R√©cup√©rer les infos
  const nom = getNom();
  const email = getEmail();
  const classe = getSelectedClasse();

  if (!nom || !email) {
    alert("Veuillez remplir votre nom et votre email.");
    return;
  }

  // G√©n√©rer le code
  const code = generateCodeFor(classe);

  // Remplir le formulaire invisible
  document.getElementById("hidden-nom").value = nom;
  document.getElementById("hidden-email").value = email;
  document.getElementById("hidden-classe").value = classe;
  document.getElementById("hidden-code").value = code;

  // Soumettre le formulaire invisible vers inscription.php
  document.getElementById("send-code-form").submit();

  // Feedback imm√©diat
  alert("Inscription termin√©e ! Votre code est : " + code);

  // Rediriger vers la page d'accueil ou confirmation
  showHome();
}
</script>
      </div>
    </section>

    <!-- Connexion -->
    <section id="login" class="page hidden">
      <h2>Se connecter</h2>
      <div class="card">
        <label>Email</label><input id="l_email" type="email" placeholder="exemple@mail.com">
        <label>Code re√ßu</label><input id="l_code" placeholder="Ex: D-123456, M-123456, A-123456">
        <div class="row">
          <button onclick="login()">Se connecter</button>
          <button class="secondary" onclick="go('home')">Annuler</button>
        </div>
        <p id="login-error" class="muted hidden">Email ou code incorrect.</p>
      </div>
    </section>

    <!-- Classe: Cours, Exercices, Inbox -->
    <section id="class-page" class="page hidden">
      <h2 id="class-title">Classe</h2>
      <div class="card">
        <div class="tabbar">
          <button id="tab-cours" class="tabbtn active" onclick="setClassTab('cours')">Cours</button>
          <button id="tab-exos" class="tabbtn" onclick="setClassTab('exos')">Exercices</button>
          <button id="tab-inbox" class="tabbtn" onclick="setClassTab('inbox')">Inbox</button>
        </div>
        <div id="class-courses"></div>
        <div id="class-exercises" class="hidden"></div>
        <div id="class-inbox" class="hidden">
          <div id="student-inbox" class="chat-thread"></div>
          <div class="chat-input">
            <textarea id="student-question" placeholder="Posez votre question..."></textarea>
            <button onclick="sendQuestion()">Envoyer</button>
          </div>
        </div>
      </div>
      <div class="row">
        <button class="secondary" onclick="go('home')">Retour</button>
        <button onclick="go('dashboard')">Aller au tableau de bord</button>
      </div>
    </section>
    
    <!-- Tableau de bord -->
    <section id="dashboard" class="page hidden">
      <h2>Tableau de bord</h2>
      <div id="dashboard-courses" class="card"></div>
    </section>

    <!-- Confidentialit√© -->
    <section id="privacy" class="page hidden">
      <h2>Politique de confidentialit√©</h2>
      <div class="card">
        <p>Ce site stocke les donn√©es localement sur votre appareil (localStorage). Aucune donn√©e n‚Äôest partag√©e.</p>
      </div>
    </section>

    <!-- Admin login -->
    <section id="admin-login" class="page hidden">
      <h2>Espace administrateur</h2>
      <div class="card">
        <label>Entrer votre code</label>
        <input type="password" id="admin-code" placeholder="Entrer votre code">
        <div class="row">
          <button onclick="checkAdmin()">Entrer</button>
          <button class="secondary" onclick="go('home')">Retour</button>
        </div>
        <p id="admin-error" class="muted hidden">Code incorrect.</p>
      </div>
    </section>

    <!-- Admin panel -->
    <section id="admin-panel" class="page hidden">
      <h2>Tableau de bord Admin</h2>
      <div class="sidebar">
        <button id="btn-sec-courses" class="sidebtn active" onclick="showAdminSection('courses')">üìö Cours existants</button>
        <button id="btn-sec-exercises" class="sidebtn" onclick="showAdminSection('exercises')">üìù Exercices existants</button>
        <button id="btn-sec-users" class="sidebtn" onclick="showAdminSection('users')">üë• Liste des inscrits</button>
        <button id="btn-sec-inbox" class="sidebtn" onclick="showAdminSection('inbox')">üí¨ Inbox √©tudiants</button>
      </div>

      <!-- Courses -->
      <div id="sec-courses" class="admin-section">
        <div class="card">
          <h3>Ajouter un cours</h3>
          <input id="course-title" placeholder="Titre du cours">
          <input id="course-link" placeholder="Lien vers le fichier (optionnel)">
          <input type="file" id="course-file"
            accept=".pdf,.doc,.docx,.xls,.xlsx,.csv,.ppt,.pptx,.png,.jpg,.jpeg,.webp,.mp4,.avi,.mov,.mkv">
          <select id="course-class">
            <option value="DEB">D√©butant</option>
            <option value="MOY">Moyen</option>
            <option value="AVA">Avanc√©</option>
          </select>
          <div class="row">
            <button onclick="addCourse()">Ajouter le cours</button>
          </div>
        </div>
        <div class="card"><h3>Liste des cours par classe</h3><div id="admin-course-list"></div></div>
      </div>

      <!-- Exercises -->
      <div id="sec-exercises" class="admin-section hidden">
        <div class="card">
          <h3>Ajouter un exercice</h3>
          <input id="exercise-title" placeholder="Titre de l‚Äôexercice">
          <input id="exercise-link" placeholder="Lien vers le fichier (optionnel)">
          <input type="file" id="exercise-file"
            accept=".pdf,.doc,.docx,.xls,.xlsx,.csv,.ppt,.pptx,.png,.jpg,.jpeg,.webp,.mp4,.avi,.mov,.mkv">
          <select id="exercise-class">
            <option value="DEB">D√©butant</option>
            <option value="MOY">Moyen</option>
            <option value="AVA">Avanc√©</option>
          </select>
          <div class="row">
            <button onclick="addExercise()">Ajouter l‚Äôexercice</button>
          </div>
        </div>
        <div class="card"><h3>Liste des exercices par classe</h3><div id="admin-exercise-list"></div></div>
      </div>

      <!-- Users -->
      <div id="sec-users" class="admin-section hidden">
        <div class="card">
          <h3>Liste des inscrits</h3>
          <div class="row" style="margin-bottom:8px;">
            <button onclick="filterUsers('ALL')">Tous</button>
            <button onclick="filterUsers('DEB')">D√©butant</button>
            <button onclick="filterUsers('MOY')">Moyen</button>
            <button onclick="filterUsers('AVA')">Avanc√©</button>
          </div>
          <ul id="users-list"></ul>
        </div>
      </div>

      <!-- Inbox -->
      <div id="sec-inbox" class="admin-section hidden">
        <div class="card">
          <h3>Inbox √©tudiants</h3>
          <div class="row" style="margin-bottom:8px;">
            <button onclick="setInboxClass('ALL')">Toutes classes</button>
            <button onclick="setInboxClass('DEB')">D√©butant</button>
            <button onclick="setInboxClass('MOY')">Moyen</button>
            <button onclick="setInboxClass('AVA')">Avanc√©</button>
          </div>
          <div class="inbox-layout">
            <div class="inbox-sidebar">
              <div id="inbox-user-list" class="inbox-list"></div>
            </div>
            <div class="inbox-panel">
              <div id="inbox-thread" class="chat-thread"></div>
              <div class="chat-input">
                <textarea id="inbox-reply" placeholder="Votre r√©ponse..."></textarea>
                <button onclick="sendAdminReply()">Envoyer</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </section>
  </main>

  <footer>
    <p>Contact : +228 92 23 93 33 ¬∑ tenteessaie@gmail.com</p>
    <p>&copy; 2025 Informatique avec JUSWELL</p>
  </footer>

  <script>
    // Helpers
    function load(key, def=[]){ try{ const v=JSON.parse(localStorage.getItem(key)); return v ?? def; }catch(e){ return def; } }
    function save(key,val){ localStorage.setItem(key, JSON.stringify(val)); }
    function g(id){ return document.getElementById(id); }
    function v(id){ return g(id).value.trim(); }
    function escapeHTML(str){ if(!str) return ''; return str.replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }

    // Menu lat√©ral
    function toggleMenu(){
      const m=g('menu'), ov=g('menu-overlay');
      const isOpen=m.classList.contains('open');
      if(isOpen){ m.classList.remove('open'); ov.classList.remove('show'); }
      else { m.classList.add('open'); ov.classList.add('show'); }
    }
    function closeMenu(){ g('menu').classList.remove('open'); g('menu-overlay').classList.remove('show'); }

    // Menu
    function go(id){
      document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'));
      g(id).classList.remove('hidden');
      g('top-right').style.display=(id==='home')?'flex':'none';
      closeMenu();
      if(id==='dashboard') renderDashboard();
      if(id==='admin-panel'){ renderAdmin(); renderInboxAdmin(); }
      if(id==='class-page') renderClass();
    }

    // Inscription
    function nextStep(step){
      if(step===1){
        const last=v('r_last'), first=v('r_first'), email=v('r_email');
        const phoneCode=v('r_phone_code'), phone=v('r_phone'), city=v('r_city'), country=v('r_country');
        if(!last||!first||!email||!phoneCode||!phone||!city||!country){ alert('Veuillez remplir tous les champs de l‚Äô√©tape 1.'); return; }
        save('register_tmp',{last,first,email,phoneCode,phone,city,country}); go('register-step2');
      }else if(step===2){
        const study=g('r_study').value, job=v('r_job'), it=g('r_it').value, training=g('r_training').value;
        const tmp=load('register_tmp',null); if(!tmp){ alert('Veuillez reprendre √† l‚Äô√©tape 1.'); return; }
        save('register_tmp',{...tmp,study,job,it,training}); go('register-step3');
      }
    }
    function finishRegister(){
      if(!g('r_confirm').checked){ alert('Veuillez confirmer le paiement.'); return; }
      const data=load('register_tmp',null); if(!data){ alert('Inscription incompl√®te.'); return; }
      const prefixMap={DEB:'D',MOY:'M',AVA:'A'}; const code=(prefixMap[data.training]||'D')+'-'+Math.floor(100000+Math.random()*900000);
      const fullName=data.first+' '+data.last;
      const students=load('students'); students.push({
        name:fullName,email:data.email,cls:data.training,code,
        phoneCode:data.phoneCode,phone:data.phone,city:data.city,country:data.country,
        study:data.study||'',job:data.job||'',it:data.it||''
      }); save('students',students);
      save('current_user',{email:data.email,code,cls:data.training,name:fullName});
      alert('Inscription termin√©e. Votre code: '+code);
      localStorage.removeItem('register_tmp'); go('login');
    }

    // Auth
    let pendingClass=null;
    function login(){
      const email=v('l_email'), code=v('l_code');
      const students=load('students'); const user=students.find(s=>s.email===email && s.code===code);
      if(!user){ g('login-error').classList.remove('hidden'); return; }
      g('login-error').classList.add('hidden'); save('current_user',user);
      if(pendingClass){ openClass(pendingClass); pendingClass=null; } else { go('dashboard'); }
    }
    function logout(){ localStorage.removeItem('current_user'); alert('D√©connect√©.'); go('home'); }

    // Classe
    let activeClassTab='cours';
    function openClass(cls){
      const user=load('current_user',null);
      if(!user){ pendingClass=cls; alert('Veuillez vous connecter pour acc√©der √† la classe.'); go('login'); return; }
      if(user.cls!==cls){ alert("Acc√®s refus√© : vous n'√™tes pas inscrit pour cette classe."); return; }
      showClass(cls);
    }
    function showClass(cls){
      const titleMap={DEB:'Classe D√©butant',MOY:'Classe Moyen',AVA:'Classe Avanc√©'};
      g('class-title').textContent=titleMap[cls]||'Classe';
      activeClassTab='cours'; updateClassTabs(); renderClass(); go('class-page');
    }
    function setClassTab(tab){ activeClassTab=tab; updateClassTabs(); }
    function updateClassTabs(){
      ['tab-cours','tab-exos','tab-inbox'].forEach(id=>g(id).classList.remove('active'));
      g('tab-'+(activeClassTab==='exos'?'exos':activeClassTab)).classList.add('active');
      g('class-courses').classList.add('hidden'); g('class-exercises').classList.add('hidden'); g('class-inbox').classList.add('hidden');
      if(activeClassTab==='cours') g('class-courses').classList.remove('hidden');
      else if(activeClassTab==='exos') g('class-exercises').classList.remove('hidden');
      else g('class-inbox').classList.remove('hidden');
    }
    function renderClass(){
      const user=load('current_user',null); if(!user) return;
      const cls=user.cls;
      const courses=load('courses').filter(c=>c.cls===cls);
      const exos=load('exercises').filter(e=>e.cls===cls);
      g('class-courses').innerHTML = courses.length? courses.map(fileItemHTML).join('') : '<p class="muted">Aucun cours pour le moment.</p>';
      g('class-exercises').innerHTML = exos.length? exos.map(fileItemHTML).join('') : '<p class="muted">Aucun exercice pour le moment.</p>';
      renderStudentInbox();
    }
    function fileItemHTML(item){
      const name=item.title||'Fichier';
      const link=item.link||'#';
      const type=item.type||'';
      return `<div class="file-item"><a href="${link}" target="_blank" rel="noopener">${escapeHTML(name)}</a><span class="muted">${escapeHTML(type)}</span></div>`;
    }

    // Messagerie √©tudiante
    function getConversations(){ return load('conversations'); } // [{email,name,cls,thread:[{from,text,time}]}]
    function saveConversations(list){ save('conversations',list); }
    function renderStudentInbox(){
      const user=load('current_user',null); if(!user) return;
      const convs=getConversations(); const conv=convs.find(c=>c.email===user.email);
      const box=g('student-inbox');
      if(!conv || conv.thread.length===0){ box.innerHTML='<p class="muted">Aucune conversation pour le moment.</p>'; return; }
      box.innerHTML = conv.thread.map(m=>{
        const whoClass = m.from==='student'?'student':'admin';
        return `<div class="msg ${whoClass}">${escapeHTML(m.text)}</div>`;
      }).join('');
      box.scrollTop = box.scrollHeight;
    }
    function sendQuestion(){
      const user=load('current_user',null); if(!user){ alert('Veuillez vous connecter.'); return; }
      const text=v('student-question'); if(!text){ alert('Veuillez √©crire une question.'); return; }
      let list=getConversations(); let conv=list.find(c=>c.email===user.email);
      if(!conv){ conv={email:user.email,name:user.name,cls:user.cls,thread:[]}; list.push(conv); }
      conv.thread.push({from:'student',text,time:Date.now()}); saveConversations(list);
      g('student-question').value=''; renderStudentInbox(); alert('Question envoy√©e.');
    }

    // Admin
    function checkAdmin(){
      const code=v('admin-code');
      if(code==='gsm'){ g('admin-error').classList.add('hidden'); go('admin-panel'); showAdminSection('courses'); }
      else { g('admin-error').classList.remove('hidden'); }
    }
    function showAdminSection(sec){
      ['courses','exercises','users','inbox'].forEach(s=>{
        const secEl=g('sec-'+s); if(secEl) secEl.classList.add('hidden');
        const btnEl=g('btn-sec-'+s); if(btnEl) btnEl.classList.remove('active');
      });
      g('sec-'+sec).classList.remove('hidden'); g('btn-sec-'+sec).classList.add('active');
      if(sec==='courses') renderAdminCourses();
      if(sec==='exercises') renderAdminExercises();
      if(sec==='users') renderAdminUsers();
      if(sec==='inbox') renderInboxAdmin();
    }

    // Ajout cours/exercices (lien ou fichier)
    async function addCourse(){
      const title=v('course-title'), cls=g('course-class').value;
      const link=v('course-link'), file=g('course-file').files[0];
      if(!title){ alert('Titre requis'); return; }
      let storedLink='', type='';
      if(file){ const data=await fileToBase64(file); storedLink=data; type=file.type||'fichier'; }
      else if(link){ storedLink=link; type=guessTypeFromLink(link); }
      else{ alert('Fournissez un lien ou t√©l√©versez un fichier.'); return; }
      const courses=load('courses'); courses.push({title,cls,link:storedLink,type}); save('courses',courses);
      clearCourseForm(); renderAdminCourses(); alert('Cours ajout√©.');
    }
    function clearCourseForm(){ g('course-title').value=''; g('course-link').value=''; g('course-file').value=''; g('course-class').value='DEB'; }
    async function addExercise(){
      const title=v('exercise-title'), cls=g('exercise-class').value;
      const link=v('exercise-link'), file=g('exercise-file').files[0];
      if(!title){ alert('Titre requis'); return; }
      let storedLink='', type='';
      if(file){ const data=await fileToBase64(file); storedLink=data; type=file.type||'fichier'; }
      else if(link){ storedLink=link; type=guessTypeFromLink(link); }
      else{ alert('Fournissez un lien ou t√©l√©versez un fichier.'); return; }
      const exos=load('exercises'); exos.push({title,cls,link:storedLink,type}); save('exercises',exos);
      clearExerciseForm(); renderAdminExercises(); alert('Exercice ajout√©.');
    }
    function clearExerciseForm(){ g('exercise-title').value=''; g('exercise-link').value=''; g('exercise-file').value=''; g('exercise-class').value='DEB'; }

    function fileToBase64(file){
      return new Promise((resolve,reject)=>{
        const reader=new FileReader();
        reader.onload=()=>resolve(reader.result);
        reader.onerror=reject;
        reader.readAsDataURL(file);
      });
    }
    function guessTypeFromLink(link){
      const l=link.toLowerCase();
      if(l.endsWith('.pdf')) return 'application/pdf';
      if(l.endsWith('.doc')||l.endsWith('.docx')) return 'application/msword';
      if(l.endsWith('.xls')||l.endsWith('.xlsx')||l.endsWith('.csv')) return 'application/vnd.ms-excel';
      if(l.endsWith('.ppt')||l.endsWith('.pptx')) return 'application/vnd.ms-powerpoint';
      if(l.endsWith('.png')) return 'image/png';
      if(l.endsWith('.jpg')||l.endsWith('.jpeg')) return 'image/jpeg';
      if(l.endsWith('.webp')) return 'image/webp';
      if(l.endsWith('.mp4')) return 'video/mp4';
      if(l.endsWith('.mov')) return 'video/quicktime';
      if(l.endsWith('.avi')) return 'video/x-msvideo';
      if(l.endsWith('.mkv')) return 'video/x-matroska';
      return 'lien';
    }

    // Rendus Admin
    function renderAdminCourses(){
      const courses=load('courses'); const groups={DEB:[],MOY:[],AVA:[]}; courses.forEach(c=>groups[c.cls]?.push(c));
      g('admin-course-list').innerHTML = ['DEB','MOY','AVA'].map(k=>{
        const lbl=k==='DEB'?'D√©butant':(k==='MOY'?'Moyen':'Avanc√©');
        const items = groups[k].length? groups[k].map(fileItemHTML).join('') : '<p class="muted">‚Äî</p>';
        return `<div class="card"><strong>${lbl}</strong>${items}</div>`;
      }).join('');
    }
    function renderAdminExercises(){
      const exos=load('exercises'); const groups={DEB:[],MOY:[],AVA:[]}; exos.forEach(e=>groups[e.cls]?.push(e));
      g('admin-exercise-list').innerHTML = ['DEB','MOY','AVA'].map(k=>{
        const lbl=k==='DEB'?'D√©butant':(k==='MOY'?'Moyen':'Avanc√©');
        const items = groups[k].length? groups[k].map(fileItemHTML).join('') : '<p class="muted">‚Äî</p>';
        return `<div class="card"><strong>${lbl}</strong>${items}</div>`;
      }).join('');
    }

    // Admin: inscrits
    function renderAdminUsers(){ renderUsersList('ALL'); }
    function filterUsers(cls){ renderUsersList(cls); }
    function renderUsersList(filter){
      const students=load('students'); const ul=g('users-list'); ul.innerHTML='';
      const filtered=students.filter(s=>filter==='ALL'?true:s.cls===filter);
      if(filtered.length===0){ ul.innerHTML='<li class="muted">Aucun inscrit.</li>'; return; }
      filtered.forEach((s,idx)=>{
        const clsLabel=s.cls==='DEB'?'D√©butant':(s.cls==='MOY'?'Moyen':'Avanc√©');
        const id=`details-${filter}-${idx}`;
        const li=document.createElement('li');
        li.innerHTML=`
          <strong>${escapeHTML(s.name)||'(Sans nom)'}</strong> ‚Äî ${clsLabel}
          <button class="secondary" onclick="toggleDetails('${id}')">D√©tails</button>
          <div id="${id}" class="details hidden">
            <div><strong>Email:</strong> ${escapeHTML(s.email)||'‚Äî'}</div>
            <div><strong>T√©l√©phone:</strong> ${escapeHTML(s.phoneCode)||'‚Äî'} ${escapeHTML(s.phone)||''}</div>
            <div><strong>Ville:</strong> ${escapeHTML(s.city)||'‚Äî'}</div>
            <div><strong>Pays:</strong> ${escapeHTML(s.country)||'‚Äî'}</div>
            <div><strong>Niveau d‚Äô√©tude:</strong> ${escapeHTML(s.study)||'‚Äî'}</div>
            <div><strong>Profession:</strong> ${escapeHTML(s.job)||'‚Äî'}</div>
            <div><strong>Niveau informatique:</strong> ${escapeHTML(s.it)||'‚Äî'}</div>
            <div><strong>Code:</strong> ${escapeHTML(s.code)||'‚Äî'}</div>
            <div><strong>Classe:</strong> ${clsLabel}</div>
          </div>`;
        ul.appendChild(li);
      });
    }
    function toggleDetails(id){ const el=g(id); el.classList.toggle('hidden'); }

    // Admin: Inbox regroup√©e par classe
    let inboxClassFilter='ALL';
    let inboxSelectedEmail=null;
    function setInboxClass(cls){ inboxClassFilter=cls; inboxSelectedEmail=null; renderInboxAdmin(); }
    function renderInboxAdmin(){
      const conversations=getConversations();
      const filtered=conversations.filter(c=>inboxClassFilter==='ALL'?true:c.cls===inboxClassFilter);
      const list=g('inbox-user-list'); list.innerHTML='';
      if(filtered.length===0){ list.innerHTML='<div class="muted">Aucune conversation.</div>'; g('inbox-thread').innerHTML=''; return; }
      filtered.forEach(conv=>{
        const initials=(conv.name||'?').charAt(0).toUpperCase();
        const item=document.createElement('div');
        item.className='inbox-user';
        item.innerHTML=`<div class="avatar">${initials}</div>
                        <div><div><strong>${escapeHTML(conv.name)}</strong></div><div class="muted">${conv.cls}</div></div>`;
        item.onclick=()=>{ inboxSelectedEmail=conv.email; openAdminConversation(conv.email); };
        list.appendChild(item);
      });
      if(!inboxSelectedEmail && filtered[0]){ inboxSelectedEmail=filtered[0].email; openAdminConversation(inboxSelectedEmail); }
    }
    function openAdminConversation(email){
      const conversations=getConversations(); const conv=conversations.find(c=>c.email===email);
      if(!conv){ g('inbox-thread').innerHTML='<div class="muted">Aucune conversation.</div>'; return; }
      g('inbox-thread').innerHTML = conv.thread.map(m=>{
        const who = m.from==='admin' ? 'admin' : 'student';
        return `<div class="msg ${who}">${escapeHTML(m.text)}</div>`;
      }).join('');
      g('inbox-thread').scrollTop = g('inbox-thread').scrollHeight;
    }
    function sendAdminReply(){
      if(!inboxSelectedEmail){ alert('S√©lectionnez une conversation.'); return; }
      const text=v('inbox-reply'); if(!text){ alert('√âcrivez une r√©ponse.'); return; }
      const conversations=getConversations(); const conv=conversations.find(c=>c.email===inboxSelectedEmail);
      if(!conv){ alert('Conversation introuvable.'); return; }
      conv.thread.push({from:'admin',text,time:Date.now()}); saveConversations(conversations);
      g('inbox-reply').value=''; openAdminConversation(inboxSelectedEmail);
    }

    // Dashboard
    function renderDashboard(){
      const courses=load('courses'); const groups={DEB:[],MOY:[],AVA:[]}; courses.forEach(c=>groups[c.cls]?.push(c.title));
      g('dashboard-courses').innerHTML = `
        <div class="card"><strong>D√©butant:</strong> ${groups.DEB.join(', ')||'‚Äî'}</div>
        <div class="card"><strong>Moyen:</strong> ${groups.MOY.join(', ')||'‚Äî'}</div>
        <div class="card"><strong>Avanc√©:</strong> ${groups.AVA.join(', ')||'‚Äî'}</div>`;
    }

    // Init storage
    if(!localStorage.getItem('courses')) save('courses',[]);
    if(!localStorage.getItem('exercises')) save('exercises',[]);
    if(!localStorage.getItem('students')) save('students',[]);
    if(!localStorage.getItem('conversations')) save('conversations',[]);
    go('home'); document.addEventListener("DOMContentLoaded", function() {
    const homeSection = document.getElementById("home");
    if (homeSection) {
      // Cherche l'image dans la section Accueil
      const img = homeSection.querySelector("img");
      if (img) {
        // Cr√©e un nouvel √©l√©ment <p> avec ton texte
        const message = document.createElement("p");
        message.textContent = "Bienvenue √† la formation en informatique!";
        message.style.fontSize = "1.2em";
        message.style.fontWeight = "bold";
        message.style.color = "#1453ff";
      }
    }
  });
  </script>
  <style>
  /* Mettre pays, indicatif et num√©ro sur la m√™me ligne */
  .phone-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
  }
  #r_country {
    flex: 2;
  }
  #r_phone_code {
    width: 80px;
    text-align: center;
  }
  #r_phone {
    flex: 3;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const countrySelect = document.getElementById("r_country");
    const phoneCode = document.getElementById("r_phone_code");
    const phoneNumber = document.getElementById("r_phone");

    // Table des indicatifs et longueurs minimales
    const phoneRules = {
      "TG": { code: "+228", minLength: 8 },   // Togo
      "FR": { code: "+33",  minLength: 10 },  // France
      "US": { code: "+1",   minLength: 10 },  // √âtats-Unis
      "GH": { code: "+233", minLength: 9 },   // Ghana
      "NG": { code: "+234", minLength: 10 }   // Nigeria
      // üëâ tu peux ajouter d‚Äôautres pays ici
    };
    
    // Met √† jour l‚Äôindicatif et la r√®gle selon le pays choisi
    function updatePhoneRule() {
      const selected = countrySelect.value;
      if (phoneRules[selected]) {
        phoneCode.value = phoneRules[selected].code;
        phoneNumber.setAttribute("data-minlength", phoneRules[selected].minLength);
      }
    }
    
    // V√©rifie la validit√© du num√©ro
    phoneNumber.addEventListener("input", function() {
      phoneNumber.value = phoneNumber.value.replace(/\D/g, ""); // garde seulement les chiffres
      const minLength = parseInt(phoneNumber.getAttribute("data-minlength")) || 8;
      if (phoneNumber.value.length < minLength) {
        phoneNumber.setCustomValidity("Le num√©ro doit contenir au moins " + minLength + " chiffres.");
      } else {
        phoneNumber.setCustomValidity("");
      }
    });

    // Initialisation
    updatePhoneRule();
    countrySelect.addEventListener("change", updatePhoneRule);
  });
</script>
</body>
</html>
